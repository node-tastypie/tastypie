<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Tastypie Tutorial: Defining Custom Routes</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.paper.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Tastypie</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-tastypie.html">tastypie</a></li><li><a href="module-tastypie_fields.html">tastypie/fields</a></li><li><a href="module-tastypie_fields_api.html">tastypie/fields/api</a></li><li><a href="module-tastypie_fields_array.html">tastypie/fields/array</a></li><li><a href="module-tastypie_fields_boolean.html">tastypie/fields/boolean</a></li><li><a href="module-tastypie_fields_char.html">tastypie/fields/char</a></li><li><a href="module-tastypie_fields_date.html">tastypie/fields/date</a></li><li><a href="module-tastypie_fields_datetime.html">tastypie/fields/datetime</a></li><li><a href="module-tastypie_fields_file.html">tastypie/fields/file</a></li><li><a href="module-tastypie_fields_filepath.html">tastypie/fields/filepath</a></li><li><a href="module-tastypie_fields_float.html">tastypie/fields/float</a></li><li><a href="module-tastypie_fields_integer.html">tastypie/fields/integer</a></li><li><a href="module-tastypie_fields_object.html">tastypie/fields/object</a></li><li><a href="module-tastypie_fields_related.html">tastypie/fields/related</a></li><li><a href="module-tastypie_lib_api.html">tastypie/lib/api</a></li><li><a href="module-tastypie_lib_cache.html">tastypie/lib/cache</a></li><li><a href="module-tastypie_lib_class.html">tastypie/lib/class</a></li><li><a href="module-tastypie_lib_class_options.html">tastypie/lib/class/options</a></li><li><a href="module-tastypie_lib_constants.html">tastypie/lib/constants</a></li><li><a href="module-tastypie_lib_exceptions.html">tastypie/lib/exceptions</a></li><li><a href="module-tastypie_lib_http.html">tastypie/lib/http</a></li><li><a href="module-tastypie_lib_mime.html">tastypie/lib/mime</a></li><li><a href="module-tastypie_lib_paginator.html">tastypie/lib/paginator</a></li><li><a href="module-tastypie_lib_resource.html">tastypie/lib/resource</a></li><li><a href="module-tastypie_lib_resource_detail.html">tastypie/lib/resource/detail</a></li><li><a href="module-tastypie_lib_resource_list.html">tastypie/lib/resource/list</a></li><li><a href="module-tastypie_lib_resource_schema.html">tastypie/lib/resource/schema</a></li><li><a href="module-tastypie_lib_resource_validator.html">tastypie/lib/resource/validator</a></li><li><a href="module-tastypie_lib_resource_validator_querystring.html">tastypie/lib/resource/validator/querystring</a></li><li><a href="module-tastypie_lib_serializer.html">tastypie/lib/serializer</a></li><li><a href="module-tastypie_lib_throttle.html">tastypie/lib/throttle</a></li><li><a href="module-tastypie_lib_util.html">tastypie/lib/util</a></li><li><a href="module-tastypie_lib_validators.html">tastypie/lib/validators</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-lib_execpetions.BaseException.html">lib/execpetions.BaseException</a></li><li><a href="module-tastypie_lib_exceptions.ImproperlyConfigured.html">tastypie/lib/exceptions.ImproperlyConfigured</a></li><li><a href="module-tastypie_lib_exceptions.NotImplemented.html">tastypie/lib/exceptions.NotImplemented</a></li><li><a href="module-tastypie_lib_exceptions.ResourceFilterError.html">tastypie/lib/exceptions.ResourceFilterError</a></li><li><a href="module-tastypie_lib_exceptions.SerializationError.html">tastypie/lib/exceptions.SerializationError</a></li><li><a href="module-tastypie_lib_exceptions.UnsupportedFormat.html">tastypie/lib/exceptions.UnsupportedFormat</a></li><li><a href="module-tastypie_lib_paginator.Remote.html">tastypie/lib/paginator.Remote</a></li><li><a href="module-tastypie_lib_throttle.Memory.html">tastypie/lib/throttle.Memory</a></li><li><a href="module-tastypie_lib_validators.FormValidator.html">tastypie/lib/validators.FormValidator</a></li><li><a href="module-tastypie_lib_validators.JoiValidator.html">tastypie/lib/validators.JoiValidator</a></li><li><a href="module-tastypie_lib_validators.Validator.html">tastypie/lib/validators.Validator</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-getting-started.html">Getting Started</a></li><li><a href="tutorial-resources.html">Working With Resources</a></li><li><a href="tutorial-serializers.html">Working With Serializers</a></li><li><a href="tutorial-wfields.html">Working With Fields</a></li>
				</ul>
			</li>
			
		</ul>
		<div class="col-sm-3 col-md-3">
            <form class="navbar-form" role="search">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                    <div class="input-group-btn">
                        <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                    </div>
                </div>
            </form>
        </div>
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			<section class="tutorial-section">

<header>
    

    <h2>Defining Custom Routes</h2>
</header>

<article>
    <p>While tastypie makes it easy to quickly create CRUD endpoints for data soures, it is certainly not restricted to dealing only with CRUD operations. You can define any number of endpoints to do whatever you want. To create a custom set of endpoints there are three basic things you need to do:</p>
<ul>
<li>Define a route</li>
<li>Define a handler</li>
<li>Define Method Access</li>
</ul>
<p><a href="/2015/06/25/custom-api-resources-with-node-tastypie">Last time</a> we wrote a very simple resource that allowed use to just return simple objects. We are going to continue with that example by adding some custom routes to it. If you are joining in late, here is the example as we left it last time.</p>
<pre class="prettyprint source"><code>var Resource = require('tastypie').Resource; 

var Simple = Resource.extend({  
    get_list: function( bundle ){ 
        // use the respond method if you 
        // want serialization, status code, etc... 
        bundle.data = { key:'value' }; 
        return this.respond( bundle ) 
    } 
    , get_detail: function( bundle ){ 
        // or just send a straight response. 
        return bundle.res({succes:1}).code( 200 ) 
    } 
    , put_detail: function( bundle ){ 
        return bundle.res({any:'data you want'}).code( 202 ) 
    } 
    , post_list: function( bundle ){ 
        var data = bundle.req.payload; 
        // do something with the data. 
        return bundle.res({any:'data you want'}).code( 201 ) 
    } 
    , delete_detail: function( bundle ){ 
        return bundle.res().code( 204 ) 
    } 
});</code></pre><h4>Define A Route</h4><p>For this example we are going to add a sub resource onto the detail endpoint ( <code>/api/v1/simple/{id}/foobar</code> ). Resources have two instance methods that are used to create route definitions, <a href="https://github.com/esatterwhite/node-tastypie/blob/v0.4.4/lib/resource/index.js#L242">base_urls</a> and <a href="https://github.com/esatterwhite/node-tastypie/blob/v0.4.4/lib/resource/index.js#L715">prepend_urls</a>. <code>base_urls</code> is the method that defines the <code>list</code>, <code>detail</code> and <code>schema</code> routes. You don't really need to worry about this one unless you want to remove something. <code>prepend_url</code> returns an array of objects that gets added on to the base urls. By default it returns an empty array, so we just need to fill it in. Each definition in the array needs to have a <code>name</code>, <code>route</code> and <code>handler</code> property</p>
<table class="striped hoverable"><br>  <thead><br>     <th>property</th><th>usage</th><br>  </thead><br>  <tbody><br>     <tr><br>        <td>path</td><br>        <td>a full relative url</td><br>     </tr><br>     <tr><br>        <td>name</td><br>        <td>A unique name of the endpoint</td><br>     </tr><br>     <tr><br>        <td>handler</td><br>        <td>A route handler for hapi.js</td><br>     </tr><br>  </tbody><br></table>

<p>So we just define the <code>prepend_urls</code> method here:</p>
<pre class="prettyprint source"><code>var Resource = require('tastypie').Resource; 

var Simple = Resource.extend({
    prepend_urls: function( ){
        return[{
           path: '/api/v1/simple/{pk}/foobar',
           name:'foobar',
           handler: this.dispatch_foobar.bind( this )
        }]
    }
});</code></pre><h4>Define A Handler</h4><p>What the <em>handler</em> function does is really up to you. This method is used as the Hapi route handler, and will be passed the <code>request</code> and <code>reply</code> object directly from hapi. However, to take the advantage of all of the tastypie infrastructure, you will want to funnel everything through the <a href="https://github.com/esatterwhite/node-tastypie/blob/v0.4.4/lib/resource/index.js#L280">dispatch</a> function on the resource. In the example above, we have told the resource to call <code>dispatch_foobar</code>, which would look something like this</p>
<pre class="prettyprint source"><code>, dispatch_foobar: function( req, reply ){
   // Do some custom logic & fancy magic

   return this.dispatch( 'foobar', this.bundle( req, reply ) );
}</code></pre><p>That is it -  <code>dispatch</code> kicks off the rest; <strong>throttling</strong>, <strong>method checks</strong>, <strong>caching</strong>, and determines the right instance method to call, <code>&lt;HTTPVERB&gt;_&lt;ACTION&gt;</code>. For example, to handle <strong>GET</strong> requests for particular example, we need to define a <code>get_foobar</code> method. You can do what ever you really want, but the general pattern is to give the request bundle a data property, and pass it to the <code>respond</code> instance method. The <code>respond</code> method handles content negotiation, serialization and status codes.</p>
<pre class="prettyprint source"><code>, get_foobar: function( bundle ){
   // all the magic you want
   bundle.data = { foo: 'bar' };
   return this.respond( bundle, tastypie.http.ok );
}</code></pre><p>If you want to make use of defined fields for advanced data preperation, you can use the hydrate ( incoming ) / dehydrate ( outgoing ) methods on the instance. </p>
<pre class="prettyprint source"><code>, get_foobar: function( bundle ){
   // all the magic you want
   getData( function( err, data ){
       this.full_dehydtate( data, bundle, function(e, dhyd ){
             bundle.data = dhyd;
             return this.respond( bundle );
       }.bind( this ) );
   }.bind( this ) );
}</code></pre><h4>Define Method Access</h4><p>A resource allows you to specifiy which HTTP Verbs are allowed for each action that is defined, <code>foobar</code> in our case. To do that you can define an object in options, <code>allowed</code> where the <strong>keys</strong> a hash of the actions &amp; the allowed http verbs for the actions. So too allow get requests, we set the get property to true.</p>
<p>If the property is set to <code>false</code>, tastypie will automatically respond with a <code>405</code> Method Not Allowed. If the property is true, but you have not defined the appropriate instance methods, tastypie will respond with a <code>501</code> Not Implemented.</p>
<p><strong>NOTE</strong>: things in <code>options</code> are configurable when an instance of your resource is created ( <code>new Simple( { options } )</code> ). they are also inherited by sub classes, </p>
<pre class="prettyprint source"><code>var Simple = Resource.extend({
    options:{
      allowed:{ 
        foobar:{ get: true }
      }
    }
});</code></pre><p>That is all there is to it. You can really be as simple or as complex as you need and/or want to be, and make use of as much tastypie as you want. Our final resource with a custom <em>foobar</em> action might look like this:</p>
<pre class="prettyprint source"><code>var Resource = require('tastypie').Resource; 

var Simple = Resource.extend({
    options:{
      allowed: {
        foobar:{ get: true }
      }
    }

   , fields: {
      // default field definitions
   }

    , get_list: function( bundle ){ 
        // use the respond method if you 
        // want serialization, status code, etc... 
        bundle.data = { key:'value' }; 
        return this.respond( bundle ) 
    } 

    , get_detail: function( bundle ){ 
        // or just send a straight response. 
        return bundle.res({succes:1}).code( 200 ) 
    } 

    , put_detail: function( bundle ){ 
        return bundle.res({any:'data you want'}).code( 202 ) 
    } 

    , post_list: function( bundle ){ 
        var data = bundle.req.payload; 
        // do something with the data. 
        return bundle.res({any:'data you want'}).code( 201 ) 
    } 

    , delete_detail: function( bundle ){ 
        return bundle.res().code( 204 ) 
    }

   // CUSTOM Resource Action setup
   , prepend_urls: function( ){
        return[{
           path: '/api/v1/simple/{pk}/foobar',
           name:'foobar',
           handler: this.dispatch_foobar.bind( this )
        }]
    }

   , dispatch_foobar: function( req, reply ){
      // Do some custom logic & fancy magic

      return this.dispatch( 'foobar', this.bundle( req, reply ) );
   }

   , get_foobar: function( bundle ){
      // all the magic you want
      getData( function( err, data ){
         this.full_dehydtate( data, bundle, function(e, dhyd ){
            // set data & respond
            bundle.data = dhyd;
            return this.respond( bundle );
         }.bind( this ) );
      }.bind( this ) );
   }
});</code></pre>
</article>

</section>

		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>

<div class="modal fade" id="searchResults">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Search results</h4>
      </div>
      <div class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>

<footer>


	<span class="copyright">
	Eric Satterwhite &copy; 2015
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a>
	
		on 2016-05-04T12:30:48-05:00
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>
<script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>

<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : false,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			var id = $( heading ).attr( "id" );
			return id && id.replace(/\~/g, '-inner-').replace(/\./g, '-static-') || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->


<script type="text/javascript">
	$(document).ready(function() {
		SearcherDisplay.init();
	});
</script>

</body>
</html>